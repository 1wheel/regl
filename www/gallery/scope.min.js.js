(function e$$0(q,t,l){function h(b,a){if(!t[b]){if(!q[b]){var e="function"==typeof require&&require;if(!a&&e)return e(b,!0);if(x)return x(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=t[b]={exports:{}};q[b][0].call(e.exports,function(a){var e=q[b][1][a];return h(e?e:a)},e,e.exports,e$$0,q,t,l)}return t[b].exports}for(var x="function"==typeof require&&require,r=0;r<l.length;r++)h(l[r]);return h})({1:[function(c,q,t){var l=c("../regl")();l.clear({color:[0,0,0,1],depth:1});
l({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(position + offset, 0, 1);\n    }",attributes:{position:[.5,0,0,.5,1,1]},count:3})(function(){l({uniforms:{color:[1,0,0,1],offset:[0,0]}})();l({uniforms:{color:[0,0,1,1],offset:[-1,0]}})();l({uniforms:{color:[0,1,0,1],offset:[0,-1]}})();l({uniforms:{color:[1,
1,1,1],offset:[-1,-1]}})()})},{"../regl":34}],2:[function(c,q,t){function l(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}q.exports=function(h,x,r,b,a){h=r.maxAttributes;x=Array(h);for(r=0;r<h;++r)x[r]=new l;return{Record:l,scope:{},state:x}}},{}],3:[function(c,q,t){function l(b){return z[Object.prototype.toString.call(b)]|0}function h(b,a){for(var e=0;e<a.length;++e)b[e]=a[e]}function x(b,a,e,h,l,r,
x){for(var p=0,g=0;g<e;++g)for(var E=0;E<h;++E)b[p++]=a[l*g+r*E+x]}var r=c("./util/is-typed-array"),b=c("./util/is-ndarray"),a=c("./util/values"),e=c("./util/pool");t=c("./util/flatten");var E=t.flatten,Q=t.shape,z=c("./constants/arraytypes.json"),y=c("./constants/dtypes.json"),p=c("./constants/usage.json"),F=[];F[5120]=1;F[5122]=2;F[5124]=4;F[5121]=1;F[5123]=2;F[5125]=4;F[5126]=4;q.exports=function(m,c,w){function n(b){this.id=A++;this.buffer=m.createBuffer();this.type=b;this.usage=35044;this.byteLength=
0;this.dimension=1;this.dtype=5121;this.persistentData=null;w.profile&&(this.stats={size:0})}function G(b,a,e){b.byteLength=a.byteLength;m.bufferData(b.type,a,e)}function z(a,g,n,p,c,m){a.usage=n;if(Array.isArray(g)){if(a.dtype=p||5126,0<g.length)if(Array.isArray(g[0])){c=Q(g);for(var K=p=1;K<c.length;++K)p*=c[K];a.dimension=p;g=E(g,c,a.dtype);G(a,g,n);m?a.persistentData=g:e.freeType(g)}else"number"===typeof g[0]?(a.dimension=c,c=e.allocType(a.dtype,g.length),h(c,g),G(a,c,n),m?a.persistentData=c:
e.freeType(c)):r(g[0])&&(a.dimension=g[0].length,a.dtype=p||l(g[0])||5126,g=E(g,[g.length,g[0].length],a.dtype),G(a,g,n),m?a.persistentData=g:e.freeType(g))}else if(r(g))a.dtype=p||l(g),a.dimension=c,G(a,g,n),m&&(a.persistentData=new Uint8Array(new Uint8Array(g.buffer)));else if(b(g)){c=g.shape;var w=g.stride,K=g.offset,A=0,k=0,V=0,y=0;1===c.length?(A=c[0],k=1,V=w[0],y=0):2===c.length&&(A=c[0],k=c[1],V=w[0],y=w[1]);a.dtype=p||l(g.data)||5126;a.dimension=k;c=e.allocType(a.dtype,A*k);x(c,g.data,A,k,
V,y,K);G(a,c,n);m?a.persistentData=c:e.freeType(c)}}function q(a){c.bufferCount--;m.deleteBuffer(a.buffer);a.buffer=null;delete g[a.id]}var A=0,g={};n.prototype.bind=function(){m.bindBuffer(this.type,this.buffer)};n.prototype.destroy=function(){q(this)};var fa=[];w.profile&&(c.getTotalBufferSize=function(){var a=0;Object.keys(g).forEach(function(b){a+=g[b].stats.size});return a});return{create:function(a,A,G,fa){function t(a){var g=35044,e=null,k=0,h=0,c=1;Array.isArray(a)||r(a)||b(a)?e=a:"number"===
typeof a?k=a|0:a&&("data"in a&&(e=a.data),"usage"in a&&(g=p[a.usage]),"type"in a&&(h=y[a.type]),"dimension"in a&&(c=a.dimension|0),"length"in a&&(k=a.length|0));D.bind();e?z(D,e,g,h,c,fa):(m.bufferData(D.type,k,g),D.dtype=h||5121,D.usage=g,D.dimension=c,D.byteLength=k);w.profile&&(D.stats.size=D.byteLength*F[D.dtype]);return t}c.bufferCount++;var D=new n(A);g[D.id]=D;G||t(a);t._reglType="buffer";t._buffer=D;t.subdata=function(a,g){var c=(g||0)|0,k;D.bind();if(Array.isArray(a)){if(0<a.length)if("number"===
typeof a[0]){var n=e.allocType(D.dtype,a.length);h(n,a);m.bufferSubData(D.type,c,n);e.freeType(n)}else if(Array.isArray(a[0])||r(a[0]))k=Q(a),n=E(a,k,D.dtype),m.bufferSubData(D.type,c,n),e.freeType(n)}else if(r(a))m.bufferSubData(D.type,c,a);else if(b(a)){k=a.shape;var p=a.stride,w=n=0,A=0,G=0;1===k.length?(n=k[0],w=1,A=p[0],G=0):2===k.length&&(n=k[0],w=k[1],A=p[0],G=p[1]);k=Array.isArray(a.data)?D.dtype:l(a.data);k=e.allocType(k,n*w);x(k,a.data,n,w,A,G,a.offset);m.bufferSubData(D.type,c,k);e.freeType(k)}return t};
w.profile&&(t.stats=D.stats);t.destroy=function(){q(D)};return t},createStream:function(a,b){var g=fa.pop();g||(g=new n(a));g.bind();z(g,b,35040,0,1,!1);return g},destroyStream:function(a){fa.push(a)},clear:function(){a(g).forEach(q);fa.forEach(q)},getBuffer:function(a){return a&&a._buffer instanceof n?a._buffer:null},restore:function(){a(g).forEach(function(a){a.buffer=m.createBuffer();m.bindBuffer(a.type,a.buffer);m.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:z}}},{"./constants/arraytypes.json":4,
"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/flatten":24,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/values":32}],4:[function(c,q,t){q.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(c,q,t){q.exports=
{int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(c,q,t){q.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(c,q,t){q.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(c,q,t){function l(a){return Array.isArray(a)||Q(a)||z(a)}function h(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function x(a,
b,e,h){this.thisDep=a;this.contextDep=b;this.propDep=e;this.append=h}function r(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new x(!1,!1,!1,a)}function a(a,b){var e=a.type;return 0===e?(e=a.data.length,new x(!0,1<=e,2<=e,b)):4===e?(e=a.data,new x(e.thisDep,e.contextDep,e.propDep,b)):new x(3===e,2===e,1===e,b)}var e=c("./util/codegen"),E=c("./util/loop"),Q=c("./util/is-typed-array"),z=c("./util/is-ndarray"),y=c("./util/is-array-like"),p=c("./dynamic"),F=c("./constants/primitives.json"),
m=c("./constants/dtypes.json"),Y=["x","y","z","w"],w="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),n={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},
G={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},L={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},S={cw:2304,ccw:2305},A=new x(!1,!1,!1,function(){});q.exports=function(g,c,z,q,Q,t,Z,D,K,Aa,va,k,V,ma,ga){function W(d){return d.replace(".","_")}function P(d,a,b){var g=W(d);v.push(d);C[g]=f[g]=!!b;wa[g]=
a}function I(d,a,b){var g=W(d);v.push(d);Array.isArray(b)?(f[g]=b.slice(),C[g]=b.slice()):f[g]=C[g]=b;xa[g]=a}function ba(){var d=e(),a=d.link,b=d.global;d.id=Ra++;d.batchId="0";var g=a(Qa),B=d.shared={props:"a0"};Object.keys(Qa).forEach(function(d){B[d]=b.def(g,".",d)});var H=d.next={},N=d.current={};Object.keys(xa).forEach(function(d){Array.isArray(f[d])&&(H[d]=b.def(B.next,".",d),N[d]=b.def(B.current,".",d))});var Sa=d.constants={};Object.keys(Ma).forEach(function(d){Sa[d]=b.def(JSON.stringify(Ma[d]))});
d.invoke=function(f,J){switch(J.type){case 0:var b=["this",B.context,B.props,d.batchId];return f.def(a(J.data),".call(",b.slice(0,Math.max(J.data.length+1,4)),")");case 1:return f.def(B.props,J.data);case 2:return f.def(B.context,J.data);case 3:return f.def("this",J.data);case 4:return J.data.append(d,f),J.data.ref}};d.attribCache={};var J={};d.scopeAttrib=function(d){d=c.id(d);if(d in J)return J[d];var f=Aa.scope[d];f||(f=Aa.scope[d]=new Ba);return J[d]=a(f)};return d}function na(d){var f=d["static"];
d=d.dynamic;var g;if("profile"in f){var e=!!f.profile;g=b(function(d,f){return e});g.enable=e}else if("profile"in d){var B=d.profile;g=a(B,function(d,f){return d.invoke(f,B)})}return g}function ya(d,f){var g=d["static"],e=d.dynamic;if("framebuffer"in g){var B=g.framebuffer;return B?(B=D.getFramebuffer(B),b(function(d,f){var a=d.link(B),u=d.shared;f.set(u.framebuffer,".next",a);u=u.context;f.set(u,".framebufferWidth",a+".width");f.set(u,".framebufferHeight",a+".height");return a})):b(function(d,f){var a=
d.shared;f.set(a.framebuffer,".next","null");a=a.context;f.set(a,".framebufferWidth",a+".drawingBufferWidth");f.set(a,".framebufferHeight",a+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var H=e.framebuffer;return a(H,function(d,f){var a=d.invoke(f,H),u=d.shared,b=u.framebuffer,a=f.def(b,".getFramebuffer(",a,")");f.set(b,".next",a);u=u.context;f.set(u,".framebufferWidth",a+"?"+a+".width:"+u+".drawingBufferWidth");f.set(u,".framebufferHeight",a+"?"+a+".height:"+u+".drawingBufferHeight");
return a})}return null}function T(d,f,b){function g(d){if(d in e){var J=e[d];d=!0;var b=J.x|0,qa=J.y|0,N,aa;"width"in J?N=J.width|0:d=!1;"height"in J?aa=J.height|0:d=!1;return new x(!d&&f&&f.thisDep,!d&&f&&f.contextDep,!d&&f&&f.propDep,function(d,f){var a=d.shared.context,u=N;"width"in J||(u=f.def(a,".","framebufferWidth","-",b));var g=aa;"height"in J||(g=f.def(a,".","framebufferHeight","-",qa));return[b,qa,u,g]})}if(d in H){var v=H[d];d=a(v,function(d,f){var a=d.invoke(f,v),J=d.shared.context,u=
f.def(a,".x|0"),b=f.def(a,".y|0"),qa=f.def('"width" in ',a,"?",a,".width|0:","(",J,".","framebufferWidth","-",u,")"),a=f.def('"height" in ',a,"?",a,".height|0:","(",J,".","framebufferHeight","-",b,")");return[u,b,qa,a]});f&&(d.thisDep=d.thisDep||f.thisDep,d.contextDep=d.contextDep||f.contextDep,d.propDep=d.propDep||f.propDep);return d}return f?new x(f.thisDep,f.contextDep,f.propDep,function(d,f){var a=d.shared.context;return[0,0,f.def(a,".","framebufferWidth"),f.def(a,".","framebufferHeight")]}):
null}var e=d["static"],H=d.dynamic;if(d=g("viewport")){var N=d;d=new x(d.thisDep,d.contextDep,d.propDep,function(d,f){var a=N.append(d,f),u=d.shared.context;f.set(u,".viewportWidth",a[2]);f.set(u,".viewportHeight",a[3]);return a})}return{viewport:d,scissor_box:g("scissor.box")}}function ia(d){function f(d){if(d in g){var J=c.id(g[d]);d=b(function(){return J});d.id=J;return d}if(d in e){var u=e[d];return a(u,function(d,f){var a=d.invoke(f,u);return f.def(d.shared.strings,".id(",a,")")})}return null}
var g=d["static"],e=d.dynamic,B=f("frag"),H=f("vert"),N=null;r(B)&&r(H)?(N=va.program(H.id,B.id),d=b(function(d,f){return d.link(N)})):d=new x(B&&B.thisDep||H&&H.thisDep,B&&B.contextDep||H&&H.contextDep,B&&B.propDep||H&&H.propDep,function(d,f){var a=d.shared.shader,u;u=B?B.append(d,f):f.def(a,".","frag");var b;b=H?H.append(d,f):f.def(a,".","vert");return f.def(a+".program("+b+","+u+")")});return{frag:B,vert:H,progVar:d,program:N}}function ka(d,f){function g(d,f){if(d in e){var u=e[d]|0;return b(function(d,
a){f&&(d.OFFSET=u);return u})}if(d in B){var qa=B[d];return a(qa,function(d,a){var u=d.invoke(a,qa);f&&(d.OFFSET=u);return u})}return f&&H?b(function(d,f){d.OFFSET="0";return 0}):null}var e=d["static"],B=d.dynamic,H=function(){if("elements"in e){var d=e.elements;l(d)?d=t.getElements(t.create(d,!0)):d&&(d=t.getElements(d));var f=b(function(f,a){if(d){var u=f.link(d);return f.ELEMENTS=u}return f.ELEMENTS=null});f.value=d;return f}if("elements"in B){var u=B.elements;return a(u,function(d,f){var a=d.shared,
J=a.isBufferArgs,a=a.elements,b=d.invoke(f,u),g=f.def("null"),J=f.def(J,"(",b,")"),b=d.cond(J).then(g,"=",a,".createStream(",b,");")["else"](g,"=",a,".getElements(",b,");");f.entry(b);f.exit(d.cond(J).then(a,".destroyStream(",g,");"));return d.ELEMENTS=g})}return null}(),N=g("offset",!0);return{elements:H,primitive:function(){if("primitive"in e){var d=e.primitive;return b(function(f,a){return F[d]})}if("primitive"in B){var f=B.primitive;return a(f,function(d,a){var u=d.constants.primTypes,b=d.invoke(a,
f);return a.def(u,"[",b,"]")})}return H?r(H)?H.value?b(function(d,f){return f.def(d.ELEMENTS,".primType")}):b(function(){return 4}):new x(H.thisDep,H.contextDep,H.propDep,function(d,f){var a=d.ELEMENTS;return f.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in e){var d=e.count|0;return b(function(){return d})}if("count"in B){var f=B.count;return a(f,function(d,a){return d.invoke(a,f)})}return H?r(H)?H?N?new x(N.thisDep,N.contextDep,N.propDep,function(d,f){return f.def(d.ELEMENTS,
".vertCount-",d.OFFSET)}):b(function(d,f){return f.def(d.ELEMENTS,".vertCount")}):b(function(){return-1}):new x(H.thisDep||N.thisDep,H.contextDep||N.contextDep,H.propDep||N.propDep,function(d,f){var a=d.ELEMENTS;return d.OFFSET?f.def(a,"?",a,".vertCount-",d.OFFSET,":-1"):f.def(a,"?",a,".vertCount:-1")}):null}(),instances:g("instances",!1),offset:N}}function ra(d,f){var g=d["static"],e=d.dynamic,B={};v.forEach(function(d){function f(J,v){if(d in g){var qa=J(g[d]);B[u]=b(function(){return qa})}else if(d in
e){var N=e[d];B[u]=a(N,function(d,f){return v(d,f,d.invoke(f,N))})}}var u=W(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return f(function(d){return d},function(d,f,a){return a});case "depth.func":return f(function(d){return G[d]},function(d,f,a){return f.def(d.constants.compareFuncs,"[",a,"]")});case "depth.range":return f(function(d){return d},
function(d,f,a){d=f.def("+",a,"[0]");f=f.def("+",a,"[1]");return[d,f]});case "blend.func":return f(function(d){return[n["srcRGB"in d?d.srcRGB:d.src],n["dstRGB"in d?d.dstRGB:d.dst],n["srcAlpha"in d?d.srcAlpha:d.src],n["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,f,a){function u(d,b){return f.def('"',d,b,'" in ',a,"?",a,".",d,b,":",a,".",d)}d=d.constants.blendFuncs;var b=u("src","RGB"),g=u("dst","RGB"),b=f.def(d,"[",b,"]"),e=f.def(d,"[",u("src","Alpha"),"]"),g=f.def(d,"[",g,"]");d=f.def(d,"[",u("dst",
"Alpha"),"]");return[b,g,e,d]});case "blend.equation":return f(function(d){if("string"===typeof d)return[ca[d],ca[d]];if("object"===typeof d)return[ca[d.rgb],ca[d.alpha]]},function(d,f,a){var u=d.constants.blendEquations,b=f.def(),g=f.def();d=d.cond("typeof ",a,'==="string"');d.then(b,"=",g,"=",u,"[",a,"];");d["else"](b,"=",u,"[",a,".rgb];",g,"=",u,"[",a,".alpha];");f(d);return[b,g]});case "blend.color":return f(function(d){return E(4,function(f){return+d[f]})},function(d,f,a){return E(4,function(d){return f.def("+",
a,"[",d,"]")})});case "stencil.mask":return f(function(d){return d|0},function(d,f,a){return f.def(a,"|0")});case "stencil.func":return f(function(d){return[G[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,f,a){d=f.def('"cmp" in ',a,"?",d.constants.compareFuncs,"[",a,".cmp]",":",7680);var u=f.def(a,".ref|0");f=f.def('"mask" in ',a,"?",a,".mask|0:-1");return[d,u,f]});case "stencil.opFront":case "stencil.opBack":return f(function(f){return["stencil.opBack"===d?1029:1028,L[f.fail||"keep"],
L[f.zfail||"keep"],L[f.zpass||"keep"]]},function(f,a,u){function b(d){return a.def('"',d,'" in ',u,"?",g,"[",u,".",d,"]:",7680)}var g=f.constants.stencilOps;return["stencil.opBack"===d?1029:1028,b("fail"),b("zfail"),b("zpass")]});case "polygonOffset.offset":return f(function(d){return[d.factor|0,d.units|0]},function(d,f,a){d=f.def(a,".factor|0");f=f.def(a,".units|0");return[d,f]});case "cull.face":return f(function(d){var f=0;"front"===d?f=1028:"back"===d&&(f=1029);return f},function(d,f,a){return f.def(a,
'==="front"?',1028,":",1029)});case "lineWidth":return f(function(d){return d},function(d,f,a){return a});case "frontFace":return f(function(d){return S[d]},function(d,f,a){return f.def(a+'==="cw"?2304:2305')});case "colorMask":return f(function(d){return d.map(function(d){return!!d})},function(d,f,a){return E(4,function(d){return"!!"+a+"["+d+"]"})});case "sample.coverage":return f(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,f,a){d=f.def('"value" in ',a,"?+",a,".value:1");f=f.def("!!",
a,".invert");return[d,f]})}});return B}function sa(d,f){var g=d["static"],e=d.dynamic,B={};Object.keys(g).forEach(function(d){var f=g[d],a;if("number"===typeof f||"boolean"===typeof f)a=b(function(){return f});else if("function"===typeof f){var u=f._reglType;if("texture2d"===u||"textureCube"===u)a=b(function(d){return d.link(f)});else if("framebuffer"===u||"framebufferCube"===u)a=b(function(d){return d.link(f.color[0])})}else y(f)&&(a=b(function(d){return d.global.def("[",E(f.length,function(d){return f[d]}),
"]")}));a.value=f;B[d]=a});Object.keys(e).forEach(function(d){var f=e[d];B[d]=a(f,function(d,a){return d.invoke(a,f)})});return B}function da(d,f){var g=d["static"],e=d.dynamic,B={};Object.keys(g).forEach(function(d){var f=g[d],a=c.id(d),u=new Ba;if(l(f))u.state=1,u.buffer=Q.getBuffer(Q.create(f,34962,!1,!0)),u.type=0;else{var e=Q.getBuffer(f);if(e)u.state=1,u.buffer=e,u.type=0;else if(f.constant){var v=f.constant;u.buffer="null";u.state=2;"number"===typeof v?u.x=v:Y.forEach(function(d,f){f<v.length&&
(u[d]=v[f])})}else{var e=l(f.buffer)?Q.getBuffer(Q.create(f.buffer,34962,!1,!0)):Q.getBuffer(f.buffer),C=f.offset|0,k=f.stride|0,h=f.size|0,n=!!f.normalized,Pa=0;"type"in f&&(Pa=m[f.type]);f=f.divisor|0;u.buffer=e;u.state=1;u.size=h;u.normalized=n;u.type=Pa||e.dtype;u.offset=C;u.stride=k;u.divisor=f}}B[d]=b(function(d,f){var b=d.attribCache;if(a in b)return b[a];var g={isStream:!1};Object.keys(u).forEach(function(d){g[d]=u[d]});u.buffer&&(g.buffer=d.link(u.buffer),g.type=g.type||g.buffer+".dtype");
return b[a]=g})});Object.keys(e).forEach(function(d){var f=e[d];B[d]=a(f,function(d,a){function u(d){a(B[d],"=",b,".",d,"|0;")}var b=d.invoke(a,f),g=d.shared,e=g.isBufferArgs,v=g.buffer,B={isStream:a.def(!1)},C=new Ba;C.state=1;Object.keys(C).forEach(function(d){B[d]=a.def(""+C[d])});var aa=B.buffer,k=B.type;a("if(",e,"(",b,")){",B.isStream,"=true;",aa,"=",v,".createStream(",34962,",",b,");",k,"=",aa,".dtype;","}else{",aa,"=",v,".getBuffer(",b,");","if(",aa,"){",k,"=",aa,".dtype;",'}else if("constant" in ',
b,"){",B.state,"=",2,";","if(typeof "+b+'.constant === "number"){',B[Y[0]],"=",b,".constant;",Y.slice(1).map(function(d){return B[d]}).join("="),"=0;","}else{",Y.map(function(d,f){return B[d]+"="+b+".constant.length>="+f+"?"+b+".constant["+f+"]:0;"}).join(""),"}}else{","if(",e,"(",b,".buffer)){",aa,"=",v,".createStream(",34962,",",b,".buffer);","}else{",aa,"=",v,".getBuffer(",b,".buffer);","}",k,'="type" in ',b,"?",g.glTypes,"[",b,".type]:",aa,".dtype;",B.normalized,"=!!",b,".normalized;");u("size");
u("offset");u("stride");u("divisor");a("}}");a.exit("if(",B.isStream,"){",v,".destroyStream(",aa,");","}");return B})});return B}function ja(d){var f=d["static"],g=d.dynamic,e={};Object.keys(f).forEach(function(d){var a=f[d];e[d]=b(function(d,f){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(g).forEach(function(d){var f=g[d];e[d]=a(f,function(d,a){return d.invoke(a,f)})});return e}function la(d,f,a,b,g){var e=ya(d,g),v=T(d,e,g),C=ka(d,g),k=ra(d,g),h=ia(d,g),c=v.viewport;
c&&(k.viewport=c);c=W("scissor.box");(v=v[c])&&(k[c]=v);v=0<Object.keys(k).length;e={framebuffer:e,draw:C,shader:h,state:k,dirty:v};e.profile=na(d,g);e.uniforms=sa(a,g);e.attributes=da(f,g);e.context=ja(b,g);return e}function ea(d,f,a){var b=d.shared.context,g=d.scope();Object.keys(a).forEach(function(e){f.save(b,"."+e);g(b,".",e,"=",a[e].append(d,f),";")});f(g)}function M(d,f,a,b){var g=d.shared,e=g.gl,v=g.framebuffer,C;oa&&(C=f.def(g.extensions,".webgl_draw_buffers"));var k=d.constants,g=k.drawBuffer,
k=k.backBuffer;d=a?a.append(d,f):f.def(v,".next");b||f("if(",d,"!==",v,".cur){");f("if(",d,"){",e,".bindFramebuffer(",36160,",",d,".framebuffer);");oa&&f(C,".drawBuffersWEBGL(",g,"[",d,".colorAttachments.length]);");f("}else{",e,".bindFramebuffer(",36160,",null);");oa&&f(C,".drawBuffersWEBGL(",k,");");f("}",v,".cur=",d,";");b||f("}")}function ha(d,a,b){var g=d.shared,e=g.gl,C=d.current,k=d.next,c=g.current,h=g.next,n=d.cond(c,".dirty");v.forEach(function(a){a=W(a);if(!(a in b.state)){var u,g;if(a in
k){u=k[a];g=C[a];var v=E(f[a].length,function(d){return n.def(u,"[",d,"]")});n(d.cond(v.map(function(d,f){return d+"!=="+g+"["+f+"]"}).join("||")).then(e,".",xa[a],"(",v,");",v.map(function(d,f){return g+"["+f+"]="+d}).join(";"),";"))}else u=n.def(h,".",a),v=d.cond(u,"!==",c,".",a),n(v),a in wa?v(d.cond(u).then(e,".enable(",wa[a],");")["else"](e,".disable(",wa[a],");"),c,".",a,"=",u,";"):v(e,".",xa[a],"(",u,");",c,".",a,"=",u,";")}});0===Object.keys(b.state).length&&n(c,".dirty=false;");a(n)}function O(d,
f,a,b){var g=d.shared,e=d.current,v=g.current,k=g.gl;h(Object.keys(a)).forEach(function(g){var C=a[g];if(!b||b(C)){var c=C.append(d,f);if(wa[g]){var h=wa[g];r(C)?c?f(k,".enable(",h,");"):f(k,".disable(",h,");"):f(d.cond(c).then(k,".enable(",h,");")["else"](k,".disable(",h,");"));f(v,".",g,"=",c,";")}else if(y(c)){var n=e[g];f(k,".",xa[g],"(",c,");",c.map(function(d,f){return n+"["+f+"]="+d}).join(";"),";")}else f(k,".",xa[g],"(",c,");",v,".",g,"=",c,";")}})}function pa(d,f){ta&&(d.instancing=f.def(d.shared.extensions,
".angle_instanced_arrays"))}function U(d,f,a,b,g){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function v(d){p=f.def();d(p,"=",e(),";");"string"===typeof g?d(h,".count+=",g,";"):d(h,".count++;");ma&&(b?(m=f.def(),d(m,"=",l,".getNumPendingQueries();")):d(l,".beginQuery(",h,");"))}function k(d){d(h,".cpuTime+=",e(),"-",p,";");ma&&(b?d(l,".pushScopeStats(",m,",",l,".getNumPendingQueries(),",h,");"):d(l,".endQuery();"))}function C(d){var a=f.def(n,".profile");f(n,
".profile=",d,";");f.exit(n,".profile=",a,";")}var c=d.shared,h=d.stats,n=c.current,l=c.timer;a=a.profile;var p,m;if(a){if(r(a)){a.enable?(v(f),k(f.exit),C("true")):C("false");return}a=a.append(d,f);C(a)}else a=f.def(n,".profile");c=d.block();v(c);f("if(",a,"){",c,"}");d=d.block();k(d);f.exit("if(",a,"){",d,"}")}function X(d,f,a,b,g){function e(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function v(a,b,g){function e(){f("if(!",n,".buffer){",c,".enableVertexAttribArray(",h,");}");var a=g.type,v;v=g.size?f.def(g.size,"||",b):b;f("if(",n,".type!==",a,"||",n,".size!==",v,"||",aa.map(function(d){return n+"."+d+"!=="+g[d]}).join("||"),"){",c,".bindBuffer(",34962,",",B,".buffer);",c,".vertexAttribPointer(",[h,v,a,g.normalized,g.stride,g.offset],");",n,".type=",a,";",n,".size=",v,";",aa.map(function(d){return n+"."+d+"="+g[d]+";"}).join(""),"}");ta&&(a=g.divisor,f("if(",n,".divisor!==",a,
"){",d.instancing,".vertexAttribDivisorANGLE(",[h,a],");",n,".divisor=",a,";}"))}function C(){f("if(",n,".buffer){",c,".disableVertexAttribArray(",h,");","}if(",Y.map(function(d,f){return n+"."+d+"!=="+l[f]}).join("||"),"){",c,".vertexAttrib4f(",h,",",l,");",Y.map(function(d,f){return n+"."+d+"="+l[f]+";"}).join(""),"}")}var c=k.gl,h=f.def(a,".location"),n=f.def(k.attributes,"[",h,"]");a=g.state;var B=g.buffer,l=[g.x,g.y,g.z,g.w],aa=["buffer","normalized","offset","stride"];1===a?e():2===a?C():(f("if(",
a,"===",1,"){"),e(),f("}else{"),C(),f("}"))}var k=d.shared;b.forEach(function(b){var c=b.name,k=a.attributes[c],C;if(k){if(!g(k))return;C=k.append(d,f)}else{if(!g(A))return;var h=d.scopeAttrib(c);C={};Object.keys(new Ba).forEach(function(d){C[d]=f.def(h,".",d)})}v(d.link(b),e(b.info.type),C)})}function R(d,f,a,g,b){for(var e=d.shared,v=e.gl,k,C=0;C<g.length;++C){var h=g[C],n=h.name,l=h.info.type,p=a.uniforms[n],h=d.link(h)+".location",m;if(p){if(!b(p))continue;if(r(p)){n=p.value;if(35678===l||35680===
l)l=d.link(n._texture||n.color[0]._texture),f(v,".uniform1i(",h,",",l+".bind());"),f.exit(l,".unbind();");else if(35674===l||35675===l||35676===l)n=d.global.def("new Float32Array(["+Array.prototype.slice.call(n)+"])"),p=2,35675===l?p=3:35676===l&&(p=4),f(v,".uniformMatrix",p,"fv(",h,",false,",n,");");else{switch(l){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:k="1i";break;case 5124:k="1i";break;case 35671:k="2i";break;case 35667:k="2i";
break;case 35672:k="3i";break;case 35668:k="3i";break;case 35673:k="4i";break;case 35669:k="4i"}f(v,".uniform",k,"(",h,",",y(n)?Array.prototype.slice.call(n):n,");")}continue}else m=p.append(d,f)}else{if(!b(A))continue;m=f.def(e.uniforms,"[",c.id(n),"]")}35678===l?f("if(",m,"&&",m,'._reglType==="framebuffer"){',m,"=",m,".color[0];","}"):35680===l&&f("if(",m,"&&",m,'._reglType==="framebufferCube"){',m,"=",m,".color[0];","}");n=1;switch(l){case 35678:case 35680:l=f.def(m,"._texture");f(v,".uniform1i(",
h,",",l,".bind());");f.exit(l,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2i";n=2;break;case 35668:case 35672:k="3i";n=3;break;case 35669:case 35673:k="4i";n=4;break;case 5126:k="1f";break;case 35664:k="2f";n=2;break;case 35665:k="3f";n=3;break;case 35666:k="4f";n=4;break;case 35674:k="Matrix2fv";break;case 35675:k="Matrix3fv";break;case 35676:k="Matrix4fv"}f(v,".uniform",k,"(",h,",");if("M"===k.charAt(0)){var h=Math.pow(l-35674+2,2),w=d.global.def("new Float32Array(",
h,")");f("false,(Array.isArray(",m,")||",m," instanceof Float32Array)?",m,":(",E(h,function(d){return w+"["+d+"]="+m+"["+d+"]"}),",",w,")")}else 1<n?f(E(n,function(d){return m+"["+d+"]"})):f(m);f(");")}}function ua(d,f,a,g){function b(e){var k=h[e];return k?k.contextDep&&g.contextDynamic||k.propDep?k.append(d,a):k.append(d,f):f.def(C,".",e)}function e(){function d(){a(A,".drawElementsInstancedANGLE(",[l,p,x,m+"<<(("+x+"-5121)>>1)",w],");")}function f(){a(A,".drawArraysInstancedANGLE(",[l,m,p,w],");")}
c?E?d():(a("if(",c,"){"),d(),a("}else{"),f(),a("}")):f()}function k(){function d(){a(n+".drawElements("+[l,p,x,m+"<<(("+x+"-5121)>>1)"]+");")}function f(){a(n+".drawArrays("+[l,m,p]+");")}c?E?d():(a("if(",c,"){"),d(),a("}else{"),f(),a("}")):f()}var v=d.shared,n=v.gl,C=v.draw,h=g.draw,c=function(){var b=h.elements,e=f;if(b){if(b.contextDep&&g.contextDynamic||b.propDep)e=a;b=b.append(d,e)}else b=e.def(C,".","elements");b&&e("if("+b+")"+n+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),l=b("primitive"),
m=b("offset"),p=function(){var b=h.count,e=f;if(b){if(b.contextDep&&g.contextDynamic||b.propDep)e=a;b=b.append(d,e)}else b=e.def(C,".","count");return b}();if("number"===typeof p){if(0===p)return}else a("if(",p,"){"),a.exit("}");var w,A;ta&&(w=b("instances"),A=d.instancing);var x=c+".type",E=h.elements&&r(h.elements);ta&&("number"!==typeof w||0<=w)?"string"===typeof w?(a("if(",w,">0){"),e(),a("}else if(",w,"<0){"),k(),a("}")):e():k()}function Ea(d,f,a,b,g){f=ba();g=f.proc("body",g);ta&&(f.instancing=
g.def(f.shared.extensions,".angle_instanced_arrays"));d(f,g,a,b);return f.compile().body}function Fa(d,f,a,b){pa(d,f);X(d,f,a,b.attributes,function(){return!0});R(d,f,a,b.uniforms,function(){return!0});ua(d,f,f,a)}function Ha(d,f){var a=d.proc("draw",1);pa(d,a);ea(d,a,f.context);M(d,a,f.framebuffer);ha(d,a,f);O(d,a,f.state);U(d,a,f,!1,!0);var b=f.shader.progVar.append(d,a);a(d.shared.gl,".useProgram(",b,".program);");if(f.shader.program)Fa(d,a,f,f.shader.program);else{var g=d.global.def("{}"),e=a.def(b,
".id"),k=a.def(g,"[",e,"]");a(d.cond(k).then(k,".call(this,a0);")["else"](k,"=",g,"[",e,"]=",d.link(function(a){return Ea(Fa,d,f,a,1)}),"(",b,");",k,".call(this,a0);"))}0<Object.keys(f.state).length&&a(d.shared.current,".dirty=true;")}function Ia(d,f,a,b){function g(){return!0}d.batchId="a1";pa(d,f);X(d,f,a,b.attributes,g);R(d,f,a,b.uniforms,g);ua(d,f,f,a)}function Ca(f,a,b,g){function e(f){return f.contextDep&&v||f.propDep}function k(f){return!e(f)}pa(f,a);var v=b.contextDep,n=a.def(),h=a.def();
f.shared.props=h;f.batchId=n;var C=f.scope(),c=f.scope();a(C.entry,"for(",n,"=0;",n,"<","a1",";++",n,"){",h,"=","a0","[",n,"];",c,"}",C.exit);b.needsContext&&ea(f,c,b.context);b.needsFramebuffer&&M(f,c,b.framebuffer);O(f,c,b.state,e);b.profile&&e(b.profile)&&U(f,c,b,!1,!0);g?(X(f,C,b,g.attributes,k),X(f,c,b,g.attributes,e),R(f,C,b,g.uniforms,k),R(f,c,b,g.uniforms,e),ua(f,C,c,b)):(a=f.global.def("{}"),g=b.shader.progVar.append(f,c),h=c.def(g,".id"),C=c.def(a,"[",h,"]"),c(f.shared.gl,".useProgram(",
g,".program);","if(!",C,"){",C,"=",a,"[",h,"]=",f.link(function(a){return Ea(Ia,f,b,a,2)}),"(",g,");}",C,".call(this,a0[",n,"],",n,");"))}function Da(f,a){function b(f){return f.contextDep&&e||f.propDep}var g=f.proc("batch",2);f.batchId="0";pa(f,g);var e=!1,k=!0;Object.keys(a.context).forEach(function(f){e=e||a.context[f].propDep});e||(ea(f,g,a.context),k=!1);var v=a.framebuffer,n=!1;v?(v.propDep?e=n=!0:v.contextDep&&e&&(n=!0),n||M(f,g,v)):M(f,g,null);a.state.viewport&&a.state.viewport.propDep&&(e=
!0);ha(f,g,a);O(f,g,a.state,function(f){return!b(f)});a.profile&&b(a.profile)||U(f,g,a,!1,"a1");a.contextDep=e;a.needsContext=k;a.needsFramebuffer=n;k=a.shader.progVar;if(k.contextDep&&e||k.propDep)Ca(f,g,a,null);else if(k=k.append(f,g),g(f.shared.gl,".useProgram(",k,".program);"),a.shader.program)Ca(f,g,a,a.shader.program);else{var v=f.global.def("{}"),n=g.def(k,".id"),c=g.def(v,"[",n,"]");g(f.cond(c).then(c,".call(this,a0,a1);")["else"](c,"=",v,"[",n,"]=",f.link(function(b){return Ea(Ca,f,a,b,2)}),
"(",k,");",c,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&g(f.shared.current,".dirty=true;")}function Oa(f,a){function b(k){var v=a.shader[k];v&&g.set(e.shader,"."+k,v.append(f,g))}var g=f.proc("scope",3);f.batchId="a2";var e=f.shared,k=e.current;ea(f,g,a.context);a.framebuffer&&a.framebuffer.append(f,g);h(Object.keys(a.state)).forEach(function(b){var k=a.state[b].append(f,g);y(k)?k.forEach(function(a,e){g.set(f.next[b],"["+e+"]",a)}):g.set(e.next,"."+b,k)});U(f,g,a,!0,!0);["elements","offset",
"count","instances","primitive"].forEach(function(b){var k=a.draw[b];k&&g.set(e.draw,"."+b,""+k.append(f,g))});Object.keys(a.uniforms).forEach(function(b){g.set(e.uniforms,"["+c.id(b)+"]",a.uniforms[b].append(f,g))});Object.keys(a.attributes).forEach(function(b){var e=a.attributes[b].append(f,g),k=f.scopeAttrib(b);Object.keys(new Ba).forEach(function(f){g.set(k,"."+f,e[f])})});b("vert");b("frag");0<Object.keys(a.state).length&&(g(k,".dirty=true;"),g.exit(k,".dirty=true;"));g("a1(",f.shared.context,
",a0,",f.batchId,");")}function Na(f){if("object"===typeof f&&!y(f)){for(var a=Object.keys(f),b=0;b<a.length;++b)if(p.isDynamic(f[a[b]]))return!0;return!1}}function Ja(f,b,g){function e(f,a){n.forEach(function(d){var b=k[d];p.isDynamic(b)&&(b=f.invoke(a,b),a(l,".",d,"=",b,";"))})}var k=b["static"][g];if(k&&Na(k)){var v=f.global,n=Object.keys(k),c=!1,C=!1,h=!1,l=f.global.def("{}");n.forEach(function(b){var g=k[b];if(p.isDynamic(g))"function"===typeof g&&(g=k[b]=p.unbox(g)),b=a(g,null),c=c||b.thisDep,
h=h||b.propDep,C=C||b.contextDep;else{v(l,".",b,"=");switch(typeof g){case "number":v(g);break;case "string":v('"',g,'"');break;case "object":Array.isArray(g)&&v("[",g.join(),"]");break;default:v(f.link(g))}v(";")}});b.dynamic[g]=new p.DynamicVariable(4,{thisDep:c,contextDep:C,propDep:h,ref:l,append:e});delete b["static"][g]}}var Ba=Aa.Record,ca={add:32774,subtract:32778,"reverse subtract":32779};z.ext_blend_minmax&&(ca.min=32775,ca.max=32776);var ta=z.angle_instanced_arrays,oa=z.webgl_draw_buffers,
f={dirty:!0,profile:ga.profile},C={},v=[],wa={},xa={};P("dither",3024);P("blend.enable",3042);I("blend.color","blendColor",[0,0,0,0]);I("blend.equation","blendEquationSeparate",[32774,32774]);I("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);I("depth.func","depthFunc",513);I("depth.range","depthRange",[0,1]);I("depth.mask","depthMask",!0);I("colorMask","colorMask",[!0,!0,!0,!0]);P("cull.enable",2884);I("cull.face","cullFace",1029);I("frontFace","frontFace",2305);I("lineWidth",
"lineWidth",1);P("polygonOffset.enable",32823);I("polygonOffset.offset","polygonOffset",[0,0]);P("sample.alpha",32926);P("sample.enable",32928);I("sample.coverage","sampleCoverage",[1,!1]);P("stencil.enable",2960);I("stencil.mask","stencilMask",-1);I("stencil.func","stencilFunc",[519,0,-1]);I("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);I("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);P("scissor.enable",3089);I("scissor.box","scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);
I("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Qa={gl:g,context:V,strings:c,next:C,current:f,draw:k,elements:t,buffer:Q,shader:va,attributes:Aa.state,uniforms:K,framebuffer:D,extensions:z,timer:ma,isBufferArgs:l},Ma={primTypes:F,compareFuncs:G,blendFuncs:n,blendEquations:ca,stencilOps:L,glTypes:m,orientationType:S};oa&&(Ma.backBuffer=[1029],Ma.drawBuffer=E(q.maxDrawbuffers,function(f){return 0===f?[0]:E(f,function(f){return 36064+f})}));var Ra=0;return{next:C,current:f,
procs:function(){var a=ba(),b=a.proc("poll"),e=a.proc("refresh"),k=a.block();b(k);e(k);var v=a.shared,n=v.gl,c=v.next,C=v.current;k(C,".dirty=false;");M(a,b);M(a,e,null,!0);var h=g.getExtension("angle_instanced_arrays"),l;h&&(l=a.link(h));for(var p=0;p<q.maxAttributes;++p){var m=e.def(v.attributes,"[",p,"]"),w=a.cond(m,".buffer");w.then(n,".enableVertexAttribArray(",p,");",n,".bindBuffer(",34962,",",m,".buffer.buffer);",n,".vertexAttribPointer(",p,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",
m,".offset);")["else"](n,".disableVertexAttribArray(",p,");",n,".vertexAttrib4f(",p,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;");e(w);h&&e(l,".vertexAttribDivisorANGLE(",p,",",m,".divisor);")}Object.keys(wa).forEach(function(f){var g=wa[f],v=k.def(c,".",f),h=a.block();h("if(",v,"){",n,".enable(",g,")}else{",n,".disable(",g,")}",C,".",f,"=",v,";");e(h);b("if(",v,"!==",C,".",f,"){",h,"}")});Object.keys(xa).forEach(function(g){var v=xa[g],h=f[g],l,m,p=a.block();p(n,".",v,"(");y(h)?(v=h.length,
l=a.global.def(c,".",g),m=a.global.def(C,".",g),p(E(v,function(f){return l+"["+f+"]"}),");",E(v,function(f){return m+"["+f+"]="+l+"["+f+"];"}).join("")),b("if(",E(v,function(f){return l+"["+f+"]!=="+m+"["+f+"]"}).join("||"),"){",p,"}")):(l=k.def(c,".",g),m=k.def(C,".",g),p(l,");",C,".",g,"=",l,";"),b("if(",l,"!==",m,"){",p,"}"));e(p)});return a.compile()}(),compile:function(f,a,b,g,e){var k=ba();k.stats=k.link(e);Object.keys(a["static"]).forEach(function(f){Ja(k,a,f)});w.forEach(function(a){Ja(k,
f,a)});b=la(f,a,b,g,k);Ha(k,b);Oa(k,b);Da(k,b);return k.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/codegen":22,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/loop":28}],9:[function(c,q,t){function l(b,a){this.id=r++;this.type=b;this.data=a}function h(b){if(0===b.length)return[];var a=b.charAt(0),e=b.charAt(b.length-1);if(1<b.length&&a===e&&('"'===a||"'"===a))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,
'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return h(b.substr(0,a.index)).concat(h(a[1])).concat(h(b.substr(a.index+a[0].length)));a=b.split(".");if(1===a.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(e=0;e<a.length;++e)b=b.concat(h(a[e]));return b}function x(b){return"["+h(b).join("][")+"]"}var r=0;q.exports={DynamicVariable:l,define:function(b,a){return new l(b,x(a+""))},isDynamic:function(b){return"function"===typeof b&&!b._reglType||b instanceof
l},unbox:function(b,a){return"function"===typeof b?new l(0,b):b},accessor:x}},{}],10:[function(c,q,t){var l=c("./util/is-typed-array"),h=c("./util/is-ndarray"),x=c("./util/values"),r=c("./constants/primitives.json"),b=c("./constants/usage.json");q.exports=function(a,e,c,q){function z(a){this.id=m++;F[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function y(a,b,m,p,w,g,r){(g=r)||l(b)&&(!h(b)||l(b.data))||(g=e.oes_element_index_uint?5125:5123);a.buffer.bind();c._initBuffer(a.buffer,
b,m,g,3);b=r;if(!r){switch(a.buffer.dtype){case 5121:case 5120:b=5121;break;case 5123:case 5122:b=5123;break;case 5125:case 5124:b=5125}a.buffer.dtype=b}a.type=b;0>w&&(w=a.buffer.byteLength,5123===b?w>>=1:5125===b&&(w>>=2));a.vertCount=w;w=p;0>p&&(w=4,p=a.buffer.dimension,1===p&&(w=0),2===p&&(w=1),3===p&&(w=4));a.primType=w}function p(a){q.elementsCount--;delete F[a.id];a.buffer.destroy();a.buffer=null}var F={},m=0,t={uint8:5121,uint16:5123};e.oes_element_index_uint&&(t.uint32=5125);z.prototype.bind=
function(){this.buffer.bind()};var w=[];return{create:function(e,m){function w(g){if(g)if("number"===typeof g)x(g),A.primType=4,A.vertCount=g|0,A.type=5121;else{var e=null,c=35044,n=-1,p=-1,m=0,E=0;Array.isArray(g)||l(g)||h(g)?e=g:("data"in g&&(e=g.data),"usage"in g&&(c=b[g.usage]),"primitive"in g&&(n=r[g.primitive]),"count"in g&&(p=g.count|0),"length"in g&&(m=g.length|0),"type"in g&&(E=t[g.type]));e?y(A,e,c,n,p,m,E):(g=A.buffer,g.bind(),a.bufferData(34963,m,c),g.dtype=E||5121,g.usage=c,g.dimension=
3,g.byteLength=m,A.primType=0>n?4:n,A.vertCount=0>p?0:p,A.type=g.dtype)}else x(),A.primType=4,A.vertCount=0,A.type=5121;return w}var x=c.create(null,34963,!0),A=new z(x._buffer);q.elementsCount++;w(e);w._reglType="elements";w._elements=A;w.subdata=function(a,b){x.subdata(a,b);return w};w.destroy=function(){p(A)};return w},createStream:function(a){var b=w.pop();b||(b=new z(c.create(null,34963,!0,!1)._buffer));y(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){w.push(a)},getElements:function(a){return"function"===
typeof a&&a._elements instanceof z?a._elements:null},clear:function(){x(F).forEach(p)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/values":32}],11:[function(c,q,t){q.exports=function(c,h){function x(a){a=a.toLowerCase();var b;try{b=r[a]=c.getExtension(a)}catch(h){}return!!b}for(var r={},b=0;b<h.extensions.length;++b){var a=h.extensions[b];if(!x(a))return h.onDestroy(),h.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}h.optionalExtensions.forEach(x);return{extensions:r,restore:function(){Object.keys(r).forEach(function(a){if(!x(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],12:[function(c,q,t){var l=c("./util/values"),h=c("./util/extend"),x=[];x[6408]=4;var r=[];r[5121]=1;r[5126]=4;r[36193]=2;q.exports=function(b,a,e,c,q,z){function y(a,b,g){this.target=a;this.texture=b;this.renderbuffer=g;var e=a=0;b?(a=b.width,e=b.height):g&&(a=g.width,e=g.height);this.width=a;this.height=e}function p(a){a&&
(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function F(a,b,g){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function m(a,g){g?g.texture?b.framebufferTexture2D(36160,a,g.target,g.texture._texture.texture,0):b.framebufferRenderbuffer(36160,a,36161,g.renderbuffer._renderbuffer.renderbuffer):b.framebufferTexture2D(36160,a,3553,null,0)}function t(a){var b=3553,g=null,e=null,c=a;"object"===typeof a&&(c=a.data,"target"in
a&&(b=a.target|0));a=c._reglType;"texture2d"===a?g=c:"textureCube"===a?g=c:"renderbuffer"===a&&(e=c,b=36161);return new y(b,g,e)}function w(a,b,g,e,h){if(g)return a=c.create2D({width:a,height:b,format:e,type:h}),a._texture.refCount=0,new y(3553,a,null);a=q.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new y(36161,null,a)}function n(a){return a&&(a.texture||a.renderbuffer)}function G(a,b,g){a&&(a.texture?a.texture.resize(b,g):a.renderbuffer&&a.renderbuffer.resize(b,g))}function L(){this.id=
Z++;D[this.id]=this;this.framebuffer=b.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function S(a){a.colorAttachments.forEach(p);p(a.depthAttachment);p(a.stencilAttachment);p(a.depthStencilAttachment)}function A(a){b.deleteFramebuffer(a.framebuffer);a.framebuffer=null;z.framebufferCount--;delete D[a.id]}function g(a){var g;b.bindFramebuffer(36160,a.framebuffer);var c=a.colorAttachments;for(g=0;g<c.length;++g)m(36064+
g,c[g]);for(g=c.length;g<e.maxColorAttachments;++g)m(36064+g,null);m(36096,a.depthAttachment);m(36128,a.stencilAttachment);m(33306,a.depthStencilAttachment);b.checkFramebufferStatus(36160);b.bindFramebuffer(36160,Ka.next);Ka.cur=Ka.next;b.getError()}function fa(a,b){function e(a,b){var c,h=0,l=0,p=!0,m=!0;c=null;var E=!0,A="rgba",y="uint8",z=1,q=null,G=null,Q=null,L=!1;if("number"===typeof a)h=a|0,l=b|0||h;else if(a){"shape"in a?(l=a.shape,h=l[0],l=l[1]):("radius"in a&&(h=l=a.radius),"width"in a&&
(h=a.width),"height"in a&&(l=a.height));if("color"in a||"colors"in a)c=a.color||a.colors,Array.isArray(c);if(!c){"colorCount"in a&&(z=a.colorCount|0);"colorTexture"in a&&(E=!!a.colorTexture,A="rgba4");if("colorType"in a&&(y=a.colorType,!E))if("half float"===y||"float16"===y)A="rgba16f";else if("float"===y||"float32"===y)A="rgba32f";"colorFormat"in a&&(A=a.colorFormat,0<=La.indexOf(A)?E=!0:0<=za.indexOf(A)&&(E=!1))}if("depthTexture"in a||"depthStencilTexture"in a)L=!(!a.depthTexture&&!a.depthStencilTexture);
"depth"in a&&("boolean"===typeof a.depth?p=a.depth:(q=a.depth,m=!1));"stencil"in a&&("boolean"===typeof a.stencil?m=a.stencil:(G=a.stencil,p=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?p=m=a.depthStencil:(Q=a.depthStencil,m=p=!1))}else h=l=1;var D=null,fa=null,K=null,M=null;if(Array.isArray(c))D=c.map(t);else if(c)D=[t(c)];else for(D=Array(z),c=0;c<z;++c)D[c]=w(h,l,E,A,y);h=h||D[0].width;l=l||D[0].height;q?fa=t(q):p&&!m&&(fa=w(h,l,L,"depth","uint32"));G?K=t(G):m&&!p&&(K=w(h,l,!1,"stencil",
"uint8"));Q?M=t(Q):!q&&!G&&m&&p&&(M=w(h,l,L,"depth stencil","depth stencil"));p=null;for(c=0;c<D.length;++c)F(D[c],h,l),D[c]&&D[c].texture&&(m=x[D[c].texture._texture.format]*r[D[c].texture._texture.type],null===p&&(p=m));F(fa,h,l);F(K,h,l);F(M,h,l);S(k);k.width=h;k.height=l;k.colorAttachments=D;k.depthAttachment=fa;k.stencilAttachment=K;k.depthStencilAttachment=M;e.color=D.map(n);e.depth=n(fa);e.stencil=n(K);e.depthStencil=n(M);e.width=k.width;e.height=k.height;g(k);return e}var k=new L;z.framebufferCount++;
e(a,b);return h(e,{resize:function(a,b){var c=a|0,h=b|0||c;if(c===k.width&&h===k.height)return e;for(var n=k.colorAttachments,l=0;l<n.length;++l)G(n[l],c,h);G(k.depthAttachment,c,h);G(k.stencilAttachment,c,h);G(k.depthStencilAttachment,c,h);k.width=e.width=c;k.height=e.height=h;g(k);return e},_reglType:"framebuffer",_framebuffer:k,destroy:function(){A(k);S(k)}})}var Ka={cur:null,next:null,dirty:!1},La=["rgba"],za=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&za.push("srgba");a.ext_color_buffer_half_float&&
za.push("rgba16f","rgb16f");a.webgl_color_buffer_float&&za.push("rgba32f");var Ga=["uint8"];a.oes_texture_half_float&&Ga.push("half float","float16");a.oes_texture_float&&Ga.push("float","float32");var Z=0,D={};return h(Ka,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof L)?a:null},create:fa,createCube:function(a){function b(a){var e,n={color:null},l=0,p=null;e="rgba";var m="uint8",w=1;if("number"===typeof a)l=a|0;else if(a){"shape"in
a?l=a.shape[0]:("radius"in a&&(l=a.radius|0),"width"in a?l=a.width|0:"height"in a&&(l=a.height|0));if("color"in a||"colors"in a)p=a.color||a.colors,Array.isArray(p);p||("colorCount"in a&&(w=a.colorCount|0),"colorType"in a&&(m=a.colorType),"colorFormat"in a&&(e=a.colorFormat));"depth"in a&&(n.depth=a.depth);"stencil"in a&&(n.stencil=a.stencil);"depthStencil"in a&&(n.depthStencil=a.depthStencil)}else l=1;if(p)if(Array.isArray(p))for(a=[],e=0;e<p.length;++e)a[e]=p[e];else a=[p];else for(a=Array(w),p=
{radius:l,format:e,type:m},e=0;e<w;++e)a[e]=c.createCube(p);n.color=Array(a.length);for(e=0;e<a.length;++e)w=a[e],l=l||w.width,n.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(w=0;w<a.length;++w)n.color[w].target=34069+e;0<e&&(n.depth=g[0].depth,n.stencil=g[0].stencil,n.depthStencil=g[0].depthStencil);if(g[e])g[e](n);else g[e]=fa(n)}return h(b,{width:l,height:l,color:a})}var g=Array(6);b(a);return h(b,{faces:g,resize:function(a){var e=a|0;if(e===b.width)return b;var c=b.color;for(a=0;a<c.length;++a)c[a].resize(e);
for(a=0;6>a;++a)g[a].resize(e);b.width=b.height=e;return b},_reglType:"framebufferCube",destroy:function(){g.forEach(function(a){a.destroy()})}})},clear:function(){l(D).forEach(A)},restore:function(){l(D).forEach(function(a){a.framebuffer=b.createFramebuffer();g(a)})}})}},{"./util/extend":23,"./util/values":32}],13:[function(c,q,t){q.exports=function(c,h){var x=1;h.ext_texture_filter_anisotropic&&(x=c.getParameter(34047));var r=1,b=1;h.webgl_draw_buffers&&(r=c.getParameter(34852),b=c.getParameter(36063));
return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(h).filter(function(a){return!!h[a]}),maxAnisotropic:x,maxDrawbuffers:r,maxColorAttachments:b,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),
maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],14:[function(c,q,t){var l=c("./util/is-typed-array");q.exports=
function(c,x,r,b,a,e){return function(a){var e;e=null===x.next?5121:x.next.colorAttachments[0].texture._texture.type;var z=0,y=0,p=b.framebufferWidth,q=b.framebufferHeight,m=null;l(a)?m=a:a&&(z=a.x|0,y=a.y|0,p=(a.width||b.framebufferWidth-z)|0,q=(a.height||b.framebufferHeight-y)|0,m=a.data||null);r();a=p*q*4;m||(5121===e?m=new Uint8Array(a):5126===e&&(m=m||new Float32Array(a)));c.pixelStorei(3333,4);c.readPixels(z,y,p,q,6408,e,m);return m}}},{"./util/is-typed-array":27}],15:[function(c,q,t){var l=
c("./util/values"),h=[];h[32854]=2;h[32855]=2;h[36194]=2;h[33189]=2;h[36168]=1;h[34041]=4;h[35907]=4;h[34836]=16;h[34842]=8;h[34843]=6;q.exports=function(c,r,b,a,e){function q(a){this.id=p++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;e.profile&&(this.stats={size:0})}function t(b){var e=b.renderbuffer;c.bindRenderbuffer(36161,null);c.deleteRenderbuffer(e);b.renderbuffer=null;b.refCount=0;delete F[b.id];a.renderbufferCount--}var z={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};r.ext_srgb&&(z.srgba=35907);r.ext_color_buffer_half_float&&(z.rgba16f=34842,z.rgb16f=34843);r.webgl_color_buffer_float&&(z.rgba32f=34836);var y=[];Object.keys(z).forEach(function(a){y[z[a]]=a});var p=0,F={};q.prototype.decRef=function(){0>=--this.refCount&&t(this)};e.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(F).forEach(function(b){a+=F[b].stats.size});return a});return{create:function(b,p){function l(a,b){var p=0,m=0,g=32854;
"object"===typeof a&&a?("shape"in a?(m=a.shape,p=m[0]|0,m=m[1]|0):("radius"in a&&(p=m=a.radius|0),"width"in a&&(p=a.width|0),"height"in a&&(m=a.height|0)),"format"in a&&(g=z[a.format])):"number"===typeof a?(p=a|0,m="number"===typeof b?b|0:p):a||(p=m=1);if(p!==n.width||m!==n.height||g!==n.format)return l.width=n.width=p,l.height=n.height=m,n.format=g,c.bindRenderbuffer(36161,n.renderbuffer),c.renderbufferStorage(36161,g,p,m),e.profile&&(n.stats.size=h[n.format]*n.width*n.height),l.format=y[n.format],
l}var n=new q(c.createRenderbuffer());F[n.id]=n;a.renderbufferCount++;l(b,p);l.resize=function(a,b){var p=a|0,m=b|0||p;if(p===n.width&&m===n.height)return l;l.width=n.width=p;l.height=n.height=m;c.bindRenderbuffer(36161,n.renderbuffer);c.renderbufferStorage(36161,n.format,p,m);e.profile&&(n.stats.size=h[n.format]*n.width*n.height);return l};l._reglType="renderbuffer";l._renderbuffer=n;e.profile&&(l.stats=n.stats);l.destroy=function(){n.decRef()};return l},clear:function(){l(F).forEach(t)},restore:function(){l(F).forEach(function(a){a.renderbuffer=
c.createRenderbuffer();c.bindRenderbuffer(36161,a.renderbuffer);c.renderbufferStorage(36161,a.format,a.width,a.height)});c.bindRenderbuffer(36161,null)}}}},{"./util/values":32}],16:[function(c,q,t){var l=c("./util/values");q.exports=function(c,x,r,b){function a(a,b,e,c){this.name=a;this.id=b;this.location=e;this.info=c}function e(a,b){for(var e=0;e<a.length;++e)if(a[e].id===b.id){a[e].location=b.location;return}a.push(b)}function q(a,b,e){e=35632===a?y:p;var l=e[b];if(!l){var m=x.str(b),l=c.createShader(a);
c.shaderSource(l,m);c.compileShader(l);e[b]=l}return l}function t(a,e){this.id=Y++;this.fragId=a;this.vertId=e;this.program=null;this.uniforms=[];this.attributes=[];b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function z(p,l){var m,r;m=q(35632,p.fragId);r=q(35633,p.vertId);var y=p.program=c.createProgram();c.attachShader(y,m);c.attachShader(y,r);c.linkProgram(y);var z=c.getProgramParameter(y,35718);b.profile&&(p.stats.uniformsCount=z);var g=p.uniforms;for(m=0;m<z;++m)if(r=c.getActiveUniform(y,
m))if(1<r.size)for(var F=0;F<r.size;++F){var t=r.name.replace("[0]","["+F+"]");e(g,new a(t,x.id(t),c.getUniformLocation(y,t),r))}else e(g,new a(r.name,x.id(r.name),c.getUniformLocation(y,r.name),r));z=c.getProgramParameter(y,35721);b.profile&&(p.stats.attributesCount=z);g=p.attributes;for(m=0;m<z;++m)(r=c.getActiveAttrib(y,m))&&e(g,new a(r.name,x.id(r.name),c.getAttribLocation(y,r.name),r))}var y={},p={},F={},m=[],Y=0;b.profile&&(r.getMaxUniformsCount=function(){var a=0;m.forEach(function(b){b.stats.uniformsCount>
a&&(a=b.stats.uniformsCount)});return a},r.getMaxAttributesCount=function(){var a=0;m.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=c.deleteShader.bind(c);l(y).forEach(a);y={};l(p).forEach(a);p={};m.forEach(function(a){c.deleteProgram(a.program)});m.length=0;F={};r.shaderCount=0},program:function(a,b,e){r.shaderCount++;var c=F[b];c||(c=F[b]={});var h=c[a];h||(h=new t(b,a),z(h,e),c[a]=h,m.push(h));return h},restore:function(){y=
{};p={};for(var a=0;a<m.length;++a)z(m[a])},shader:q,frag:-1,vert:-1}}},{"./util/values":32}],17:[function(c,q,t){q.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(c,q,t){q.exports=function(){var c={"":0},h=[""];return{id:function(q){var r=c[q];if(r)return r;r=c[q]=h.length;h.push(q);return r},str:function(c){return h[c]}}}},{}],19:[function(c,q,t){function l(a){return Array.isArray(a)&&
(0===a.length||"number"===typeof a[0])}function h(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function x(a){return Object.prototype.toString.call(a)}function r(a){if(!a)return!1;var b=x(a);return 0<=L.indexOf(b)?!0:l(a)||h(a)||z(a)}function b(a,b){36193===a.type?(a.data=p(b),y.freeType(b)):a.data=b}function a(a,b,e,c,h,p){a="undefined"!==typeof A[a]?A[a]:G[a]*S[b];p&&(a*=6);if(h){for(c=0;1<=e;)c+=a*e*e,e/=2;return c}return a*e*c}var e=c("./util/extend"),E=c("./util/values"),Q=c("./util/is-typed-array"),
z=c("./util/is-ndarray"),y=c("./util/pool"),p=c("./util/to-half-float"),F=c("./util/is-array-like"),m=c("./util/flatten");t=c("./constants/arraytypes.json");var Y=c("./constants/arraytypes.json"),w=[9984,9986,9985,9987],n=[0,6409,6410,6407,6408],G={};G[6409]=G[6406]=G[6402]=1;G[34041]=G[6410]=2;G[6407]=G[35904]=3;G[6408]=G[35906]=4;var L=Object.keys(t).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),S=[];S[5121]=1;
S[5126]=4;S[36193]=2;S[5123]=2;S[5125]=4;var A=[];A[32854]=2;A[32855]=2;A[36194]=2;A[34041]=4;A[33776]=.5;A[33777]=.5;A[33778]=1;A[33779]=1;A[35986]=.5;A[35987]=1;A[34798]=1;A[35840]=.5;A[35841]=.25;A[35842]=.5;A[35843]=.25;A[36196]=.5;q.exports=function(g,c,q,A,t,L,Z){function D(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function K(a,b){a.internalformat=b.internalformat;
a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function S(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in b&&(a.colorSpace=pa[b.colorSpace]);"type"in b&&(a.type=U[b.type]);var g=
a.width,e=a.height,c=a.channels,h=!1;"shape"in b?(g=b.shape[0],e=b.shape[1],3===b.shape.length&&(c=b.shape[2],h=!0)):("radius"in b&&(g=e=b.radius),"width"in b&&(g=b.width),"height"in b&&(e=b.height),"channels"in b&&(c=b.channels,h=!0));a.width=g|0;a.height=e|0;a.channels=c|0;g=!1;"format"in b&&(g=b.format,e=a.internalformat=X[g],a.format=Oa[e],g in U&&!("type"in b)&&(a.type=U[g]),g in R&&(a.compressed=!0),g=!0);!h&&g?a.channels=G[a.format]:h&&!g&&a.channels!==n[a.format]&&(a.format=a.internalformat=
n[a.channels])}}function va(a){g.pixelStorei(37440,a.flipY);g.pixelStorei(37441,a.premultiplyAlpha);g.pixelStorei(37443,a.colorSpace);g.pixelStorei(3317,a.unpackAlignment)}function k(){D.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function V(a,g){var e=null;r(g)?e=g:g&&(S(a,g),"x"in g&&(a.xOffset=g.x|0),"y"in g&&(a.yOffset=g.y|0),r(g.data)&&(e=g.data));if(g.copy){var c=t.viewportWidth,k=t.viewportHeight;a.width=a.width||c-a.xOffset;a.height=
a.height||k-a.yOffset;a.needsCopy=!0}else if(!e)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(Q(e))a.channels=a.channels||4,a.data=e,"type"in g||5121!==a.type||(a.type=Y[Object.prototype.toString.call(e)]|0);else if(l(e)){a.channels=a.channels||4;c=e;k=c.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:k=y.allocType(a.type,k);k.set(c);a.data=k;break;case 36193:a.data=p(c)}a.alignment=1;a.needsFree=!0}else if(z(e)){c=e.data;Array.isArray(c)||5121!==a.type||(a.type=
Y[Object.prototype.toString.call(c)]|0);var k=e.shape,q=e.stride,w,E,d,u;3===k.length?(d=k[2],u=q[2]):u=d=1;w=k[0];E=k[1];k=q[0];q=q[1];a.alignment=1;a.width=w;a.height=E;a.channels=d;a.format=a.internalformat=n[d];a.needsFree=!0;w=u;e=e.offset;d=a.width;u=a.height;E=a.channels;for(var A=y.allocType(36193===a.type?5126:a.type,d*u*E),D=0,B=0;B<u;++B)for(var H=0;H<d;++H)for(var ua=0;ua<E;++ua)A[D++]=c[k*H+q*B+w*ua+e];b(a,A)}else if("[object HTMLCanvasElement]"===x(e)||"[object CanvasRenderingContext2D]"===
x(e))"[object HTMLCanvasElement]"===x(e)?a.element=e:a.element=e.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===x(e))a.element=e,a.width=e.naturalWidth,a.height=e.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===x(e))a.element=e,a.width=e.videoWidth,a.height=e.videoHeight,a.channels=4;else if(h(e)){c=a.width||e[0].length;k=a.height||e.length;q=a.channels;q=F(e[0][0])?q||e[0][0].length:q||1;w=m.shape(e);d=1;for(u=0;u<w.length;++u)d*=
w[u];d=y.allocType(36193===a.type?5126:a.type,d);m.flatten(e,w,"",d);b(a,d);a.alignment=1;a.width=c;a.height=k;a.channels=q;a.format=a.internalformat=n[q];a.needsFree=!0}}function ma(a,b,e,c,h){var k=a.element,p=a.data,l=a.internalformat,d=a.format,n=a.type,m=a.width,r=a.height;va(a);k?g.texSubImage2D(b,h,e,c,d,n,k):a.compressed?g.compressedTexSubImage2D(b,h,e,c,l,m,r,p):a.needsCopy?(A(),g.copyTexSubImage2D(b,h,e,c,a.xOffset,a.yOffset,m,r)):g.texSubImage2D(b,h,e,c,m,r,d,n,p)}function ga(){return Na.pop()||
new k}function W(a){a.needsFree&&y.freeType(a.data);k.call(a);Na.push(a)}function P(){D.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function I(a,b,e){var g=a.images[0]=ga();a.mipmask=1;g.width=a.width=b;g.height=a.height=e;g.channels=a.channels=4}function ba(a,b){var e=null;if(r(b))e=a.images[0]=ga(),K(e,a),V(e,b),a.mipmask=1;else if(S(a,b),Array.isArray(b.mipmap))for(var g=b.mipmap,c=0;c<g.length;++c)e=a.images[c]=ga(),K(e,a),e.width>>=c,e.height>>=c,V(e,
g[c]),a.mipmask|=1<<c;else e=a.images[0]=ga(),K(e,a),V(e,b),a.mipmask=1;K(a,a.images[0])}function na(a,b){for(var e=a.images,c=0;c<e.length&&e[c];++c){var h=e[c],k=b,p=c,l=h.element,d=h.data,n=h.internalformat,m=h.format,r=h.type,q=h.width,w=h.height;va(h);l?g.texImage2D(k,p,m,m,r,l):h.compressed?g.compressedTexImage2D(k,p,n,q,w,0,d):h.needsCopy?(A(),g.copyTexImage2D(k,p,m,h.xOffset,h.yOffset,q,w,0)):g.texImage2D(k,p,m,q,w,0,m,r,d)}}function ya(){var a=Ja.pop()||new P;D.call(a);for(var b=a.mipmask=
0;16>b;++b)a.images[b]=null;return a}function T(a){for(var b=a.images,e=0;e<b.length;++e)b[e]&&W(b[e]),b[e]=null;Ja.push(a)}function ia(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ka(a,b){"min"in b&&(a.minFilter=O[b.min],0<=w.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=ha[b.mag]);var e=a.wrapS,g=a.wrapT;if("wrap"in b){var c=b.wrap;"string"===typeof c?e=g=M[c]:Array.isArray(c)&&(e=M[c[0]],
g=M[c[1]])}else"wrapS"in b&&(e=M[b.wrapS]),"wrapT"in b&&(g=M[b.wrapT]);a.wrapS=e;a.wrapT=g;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){e=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=ea[b.mipmap];e=a.genMipmaps=!0;break;case "boolean":e=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,e=!0}!e||"min"in b||(a.minFilter=9984)}}function ra(a,b){g.texParameteri(b,10241,a.minFilter);g.texParameteri(b,10240,a.magFilter);g.texParameteri(b,10242,a.wrapS);g.texParameteri(b,
10243,a.wrapT);c.ext_texture_filter_anisotropic&&g.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(g.hint(33170,a.mipmapHint),g.generateMipmap(b))}function sa(a){D.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ba++;this.refCount=1;this.target=a;this.texture=g.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new ia;Z.profile&&(this.stats={size:0})}function da(a){g.activeTexture(33984);g.bindTexture(a.target,a.texture)}function ja(){var a=oa[0];a?g.bindTexture(a.target,a.texture):
g.bindTexture(3553,null)}function la(a){var b=a.texture,e=a.unit,c=a.target;0<=e&&(g.activeTexture(33984+e),g.bindTexture(c,null),oa[e]=null);g.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete ca[a.id];L.textureCount--}var ea={"don't care":4352,"dont care":4352,nice:4354,fast:4353},M={repeat:10497,clamp:33071,mirror:33648},ha={nearest:9728,linear:9729},O=e({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},
ha),pa={none:0,browser:37444},U={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},R={};c.ext_srgb&&(X.srgb=35904,X.srgba=35906);c.oes_texture_float&&(U.float32=U["float"]=5126);c.oes_texture_half_float&&(U.float16=U["half float"]=36193);c.webgl_depth_texture&&(e(X,{depth:6402,"depth stencil":34041}),e(U,{uint16:5123,uint32:5125,"depth stencil":34042}));c.webgl_compressed_texture_s3tc&&
e(R,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});c.webgl_compressed_texture_atc&&e(R,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});c.webgl_compressed_texture_pvrtc&&e(R,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});c.webgl_compressed_texture_etc1&&(R["rgb etc1"]=36196);var ua=Array.prototype.slice.call(g.getParameter(34467));Object.keys(R).forEach(function(a){var b=
R[a];0<=ua.indexOf(b)&&(X[a]=b)});var Ea=Object.keys(X);q.textureFormats=Ea;var Fa=[];Object.keys(X).forEach(function(a){Fa[X[a]]=a});var Ha=[];Object.keys(U).forEach(function(a){Ha[U[a]]=a});var Ia=[];Object.keys(ha).forEach(function(a){Ia[ha[a]]=a});var Ca=[];Object.keys(O).forEach(function(a){Ca[O[a]]=a});var Da=[];Object.keys(M).forEach(function(a){Da[M[a]]=a});var Oa=Ea.reduce(function(a,b){var e=X[b];6409===e||6406===e||6409===e||6410===e||6402===e||34041===e?a[e]=e:32855===e||0<=b.indexOf("rgba")?
a[e]=6408:a[e]=6407;return a},{}),Na=[],Ja=[],Ba=0,ca={},ta=q.maxTextureUnits,oa=Array(ta).map(function(){return null});e(sa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<ta;++b){var e=oa[b];if(e){if(0<e.bindCount)continue;e.unit=-1}oa[b]=this;a=b;break}Z.profile&&L.maxTextureUnits<a+1&&(L.maxTextureUnits=a+1);this.unit=a;g.activeTexture(33984+a);g.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&
la(this)}});Z.profile&&(L.getTotalTextureSize=function(){var a=0;Object.keys(ca).forEach(function(b){a+=ca[b].stats.size});return a});return{create2D:function(b,e){function c(b,f){var e=h.texInfo;ia.call(e);var g=ya();"number"===typeof b?"number"===typeof f?I(g,b|0,f|0):I(g,b|0,b|0):b?(ka(e,b),ba(g,b)):I(g,1,1);e.genMipmaps&&(g.mipmask=(g.width<<1)-1);h.mipmask=g.mipmask;K(h,g);h.internalformat=g.internalformat;c.width=g.width;c.height=g.height;da(h);na(g,3553);ra(e,3553);ja();T(g);Z.profile&&(h.stats.size=
a(h.internalformat,h.type,g.width,g.height,e.genMipmaps,!1));c.format=Fa[h.internalformat];c.type=Ha[h.type];c.mag=Ia[e.magFilter];c.min=Ca[e.minFilter];c.wrapS=Da[e.wrapS];c.wrapT=Da[e.wrapT];return c}var h=new sa(3553);ca[h.id]=h;L.textureCount++;c(b,e);c.subimage=function(a,b,e,f){b|=0;e|=0;f|=0;var d=ga();K(d,h);d.width=0;d.height=0;V(d,a);d.width=d.width||(h.width>>f)-b;d.height=d.height||(h.height>>f)-e;da(h);ma(d,3553,b,e,f);ja();W(d);return c};c.resize=function(b,e){var f=b|0,k=e|0||f;if(f===
h.width&&k===h.height)return c;c.width=h.width=f;c.height=h.height=k;da(h);for(var d=0;h.mipmask>>d;++d)g.texImage2D(3553,d,h.format,f>>d,k>>d,0,h.format,h.type,null);ja();Z.profile&&(h.stats.size=a(h.internalformat,h.type,f,k,!1,!1));return c};c._reglType="texture2d";c._texture=h;Z.profile&&(c.stats=h.stats);c.destroy=function(){h.decRef()};return c},createCube:function(b,e,c,h,k,p){function l(b,e,f,g,c,h){var k,p=m.texInfo;ia.call(p);for(k=0;6>k;++k)d[k]=ya();if("number"===typeof b||!b)for(b=b|
0||1,k=0;6>k;++k)I(d[k],b,b);else if("object"===typeof b)if(e)ba(d[0],b),ba(d[1],e),ba(d[2],f),ba(d[3],g),ba(d[4],c),ba(d[5],h);else if(ka(p,b),S(m,b),"faces"in b)for(b=b.faces,k=0;6>k;++k)K(d[k],m),ba(d[k],b[k]);else for(k=0;6>k;++k)ba(d[k],b);K(m,d[0]);m.mipmask=p.genMipmaps?(d[0].width<<1)-1:d[0].mipmask;m.internalformat=d[0].internalformat;l.width=d[0].width;l.height=d[0].height;da(m);for(k=0;6>k;++k)na(d[k],34069+k);ra(p,34067);ja();Z.profile&&(m.stats.size=a(m.internalformat,m.type,l.width,
l.height,p.genMipmaps,!0));l.format=Fa[m.internalformat];l.type=Ha[m.type];l.mag=Ia[p.magFilter];l.min=Ca[p.minFilter];l.wrapS=Da[p.wrapS];l.wrapT=Da[p.wrapT];for(k=0;6>k;++k)T(d[k]);return l}var m=new sa(34067);ca[m.id]=m;L.cubeCount++;var d=Array(6);l(b,e,c,h,k,p);l.subimage=function(a,b,d,e,f){d|=0;e|=0;f|=0;var g=ga();K(g,m);g.width=0;g.height=0;V(g,b);g.width=g.width||(m.width>>f)-d;g.height=g.height||(m.height>>f)-e;da(m);ma(g,34069+a,d,e,f);ja();W(g);return l};l.resize=function(b){b|=0;if(b!==
m.width){l.width=m.width=b;l.height=m.height=b;da(m);for(var d=0;6>d;++d)for(var e=0;m.mipmask>>e;++e)g.texImage2D(34069+d,e,m.format,b>>e,b>>e,0,m.format,m.type,null);ja();Z.profile&&(m.stats.size=a(m.internalformat,m.type,l.width,l.height,!1,!0));return l}};l._reglType="textureCube";l._texture=m;Z.profile&&(l.stats=m.stats);l.destroy=function(){m.decRef()};return l},clear:function(){for(var a=0;a<ta;++a)g.activeTexture(33984+a),g.bindTexture(3553,null),oa[a]=null;E(ca).forEach(la);L.cubeCount=0;
L.textureCount=0},getTexture:function(a){return null},restore:function(){E(ca).forEach(function(a){a.texture=g.createTexture();g.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)g.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var e=0;6>e;++e)g.texImage2D(34069+e,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);ra(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/extend":23,
"./util/flatten":24,"./util/is-array-like":25,"./util/is-ndarray":26,"./util/is-typed-array":27,"./util/pool":29,"./util/to-half-float":31,"./util/values":32}],20:[function(c,q,t){q.exports=function(c,h){function q(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function r(a,b,e){var c=E.pop()||new q;c.startQueryIndex=a;c.endQueryIndex=b;c.sum=0;c.stats=e;t.push(c)}var b=h.ext_disjoint_timer_query;if(!b)return null;var a=[],e=[],E=[],t=[],z=[],y=[];return{beginQuery:function(c){var h=
a.pop()||b.createQueryEXT();b.beginQueryEXT(35007,h);e.push(h);r(e.length-1,e.length,c)},endQuery:function(){b.endQueryEXT(35007)},pushScopeStats:r,update:function(){var c,h;c=e.length;if(0!==c){y.length=Math.max(y.length,c+1);z.length=Math.max(z.length,c+1);z[0]=0;var l=y[0]=0;for(h=c=0;h<e.length;++h){var r=e[h];b.getQueryObjectEXT(r,34919)?(l+=b.getQueryObjectEXT(r,34918),a.push(r)):e[c++]=r;z[h+1]=l;y[h+1]=c}e.length=c;for(h=c=0;h<t.length;++h){var l=t[h],q=l.startQueryIndex,r=l.endQueryIndex;
l.sum+=z[r]-z[q];q=y[q];r=y[r];r===q?(l.stats.gpuTime+=l.sum/1E6,E.push(l)):(l.startQueryIndex=q,l.endQueryIndex=r,t[c++]=l)}t.length=c}},getNumPendingQueries:function(){return e.length},clear:function(){a.push.apply(a,e);for(var c=0;c<a.length;c++)b.deleteQueryEXT(a[c]);e.length=0;a.length=0},restore:function(){e.length=0;a.length=0}}}},{}],21:[function(c,q,t){q.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(c,
q,t){function l(c){return Array.prototype.slice.call(c)}function h(c){return l(c).join("")}var x=c("./extend");q.exports=function(){function c(){var b=[],e=[];return x(function(){b.push.apply(b,l(arguments))},{def:function(){var c="v"+a++;e.push(c);0<arguments.length&&(b.push(c,"="),b.push.apply(b,l(arguments)),b.push(";"));return c},toString:function(){return h([0<e.length?"var "+e+";":"",h(b)])}})}function b(){function a(c,h){e(c,h,"=",b.def(c,h),";")}var b=c(),e=c(),h=b.toString,q=e.toString;return x(function(){b.apply(b,
l(arguments))},{def:b.def,entry:b,exit:e,save:a,set:function(e,c,h){a(e,c);b(e,c,"=",h,";")},toString:function(){return h()+q()}})}var a=0,e=[],q=[],t=c(),z={};return{global:t,link:function(b){for(var c=0;c<q.length;++c)if(q[c]===b)return e[c];c="g"+a++;e.push(c);q.push(b);return c},block:c,proc:function(a,e){function c(){var a="a"+l.length;l.push(a);return a}var l=[];e=e||0;for(var r=0;r<e;++r)c();var r=b(),q=r.toString;return z[a]=x(r,{arg:c,toString:function(){return h(["function(",l.join(),"){",
q(),"}"])}})},scope:b,cond:function(){var a=h(arguments),e=b(),c=b(),m=e.toString,r=c.toString;return x(e,{then:function(){e.apply(e,l(arguments));return this},"else":function(){c.apply(c,l(arguments));return this},toString:function(){var b=r();b&&(b="else{"+b+"}");return h(["if(",a,"){",m(),"}",b])}})},compile:function(){var a=['"use strict";',t,"return {"];Object.keys(z).forEach(function(b){a.push('"',b,'":',z[b].toString(),",")});a.push("}");var b=h(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,
"{\n");return Function.apply(null,e.concat(b)).apply(null,q)}}}},{"./extend":23}],23:[function(c,q,t){q.exports=function(c,h){for(var q=Object.keys(h),r=0;r<q.length;++r)c[q[r]]=h[q[r]];return c}},{}],24:[function(c,q,t){function l(c,b,a,e,h,l){for(var q=0;q<b;++q)for(var t=c[q],p=0;p<a;++p)for(var x=t[p],m=0;m<e;++m)h[l++]=x[m]}function h(c,b,a,e,q){for(var t=1,z=a+1;z<b.length;++z)t*=b[z];var x=b[a];if(4===b.length-a){var p=b[a+1],F=b[a+2];b=b[a+3];for(z=0;z<x;++z)l(c[z],p,F,b,e,q),q+=t}else for(z=
0;z<x;++z)h(c[z],b,a+1,e,q),q+=t}var x=c("./pool");q.exports={shape:function(c){for(var b=[];c.length;c=c[0])b.push(c.length);return b},flatten:function(c,b,a,e){var q=1;if(b.length)for(var t=0;t<b.length;++t)q*=b[t];else q=0;a=e||x.allocType(a,q);switch(b.length){case 0:break;case 1:e=b[0];for(b=0;b<e;++b)a[b]=c[b];break;case 2:e=b[0];b=b[1];for(t=q=0;t<e;++t)for(var z=c[t],y=0;y<b;++y)a[q++]=z[y];break;case 3:l(c,b[0],b[1],b[2],a,0);break;default:h(c,b,0,a,0)}return a}}},{"./pool":29}],25:[function(c,
q,t){var l=c("./is-typed-array");q.exports=function(c){return Array.isArray(c)||l(c)}},{"./is-typed-array":27}],26:[function(c,q,t){var l=c("./is-typed-array");q.exports=function(c){return!!c&&"object"===typeof c&&Array.isArray(c.shape)&&Array.isArray(c.stride)&&"number"===typeof c.offset&&c.shape.length===c.stride.length&&(Array.isArray(c.data)||l(c.data))}},{"./is-typed-array":27}],27:[function(c,q,t){var l=c("../constants/arraytypes.json");q.exports=function(c){return Object.prototype.toString.call(c)in
l}},{"../constants/arraytypes.json":4}],28:[function(c,q,t){q.exports=function(c,h){for(var q=Array(c),r=0;r<c;++r)q[r]=h(r);return q}},{}],29:[function(c,q,t){function l(b){var a,e;a=(65535<b)<<4;b>>>=a;e=(255<b)<<3;b>>>=e;a|=e;e=(15<b)<<2;b>>>=e;a|=e;e=(3<b)<<1;return a|e|b>>>e>>1}function h(b){a:{for(var a=16;268435456>=a;a*=16)if(b<=a){b=a;break a}b=0}a=r[l(b)>>2];return 0<a.length?a.pop():new ArrayBuffer(b)}function x(b){r[l(b.byteLength)>>2].push(b)}var r=c("./loop")(8,function(){return[]});
q.exports={alloc:h,free:x,allocType:function(b,a){var e=null;switch(b){case 5120:e=new Int8Array(h(a),0,a);break;case 5121:e=new Uint8Array(h(a),0,a);break;case 5122:e=new Int16Array(h(2*a),0,a);break;case 5123:e=new Uint16Array(h(2*a),0,a);break;case 5124:e=new Int32Array(h(4*a),0,a);break;case 5125:e=new Uint32Array(h(4*a),0,a);break;case 5126:e=new Float32Array(h(4*a),0,a);break;default:return null}return e.length!==a?e.subarray(0,a):e},freeType:function(b){x(b.buffer)}}},{"./loop":28}],30:[function(c,
q,t){q.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){return setTimeout(c,16)},cancel:clearTimeout}},{}],31:[function(c,q,t){var l=c("./pool"),h=new Float32Array(1),x=new Uint32Array(h.buffer);q.exports=function(c){for(var b=l.allocType(5123,c.length),a=0;a<c.length;++a)if(isNaN(c[a]))b[a]=65535;else if(Infinity===c[a])b[a]=31744;else if(-Infinity===
c[a])b[a]=64512;else{h[0]=c[a];var e=x[0],q=e>>>31<<15,t=(e<<1>>>24)-127,e=e>>13&1023;b[a]=-24>t?q:-14>t?q+(e+1024>>-14-t):15<t?q+31744:q+(t+15<<10)+e}return b}},{"./pool":29}],32:[function(c,q,t){q.exports=function(c){return Object.keys(c).map(function(h){return c[h]})}},{}],33:[function(c,q,t){function l(a,e,c){function h(){var e=window.innerWidth,p=window.innerHeight;a!==document.body&&(p=a.getBoundingClientRect(),e=p.right-p.left,p=p.top-p.bottom);l.width=c*e;l.height=c*p;b(l.style,{width:e+"px",
height:p+"px"})}var l=document.createElement("canvas");b(l.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(l);a===document.body&&(l.style.position="absolute",b(a.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",h);a.removeChild(l)}}}function h(a,b){function c(h){try{return a.getContext(h,b)}catch(l){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function x(a){return"string"===
typeof a?a.split():a}function r(a){return"string"===typeof a?document.querySelector(a):a}var b=c("./util/extend");q.exports=function(a){var b=a||{},c,q,t,y;a={};var p=[],F=[],m="undefined"===typeof window?1:window.devicePixelRatio,Y=!1,w=function(a){},n=function(){};"string"===typeof b?c=document.querySelector(b):"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?c=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?
(y=b,t=y.canvas):("gl"in b?y=b.gl:"canvas"in b?t=r(b.canvas):"container"in b&&(q=r(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(p=x(b.extensions)),"optionalExtensions"in b&&(F=x(b.optionalExtensions)),"onDone"in b&&(w=b.onDone),"profile"in b&&(Y=!!b.profile),"pixelRatio"in b&&(m=+b.pixelRatio)));c&&("canvas"===c.nodeName.toLowerCase()?t=c:q=c);if(!y){if(!t){c=l(q||document.body,w,m);if(!c)return null;t=c.canvas;n=c.onDestroy}y=h(t,a)}return y?{gl:y,canvas:t,container:q,extensions:p,
optionalExtensions:F,pixelRatio:m,profile:Y,onDone:w,onDestroy:n}:(n(),w("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":23}],34:[function(c,q,t){function l(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var h=c("./lib/util/extend"),x=c("./lib/dynamic"),r=c("./lib/util/raf"),b=c("./lib/util/clock"),a=c("./lib/strings"),e=c("./lib/webgl"),E=c("./lib/extension"),Q=c("./lib/limits"),z=c("./lib/buffer"),y=c("./lib/elements"),
p=c("./lib/texture"),F=c("./lib/renderbuffer"),m=c("./lib/framebuffer"),Y=c("./lib/attribute"),w=c("./lib/shader"),n=c("./lib/read"),G=c("./lib/core"),L=c("./lib/stats"),S=c("./lib/timer");q.exports=function(c){function g(){if(0===O.length)I&&I.update(),R=null;else{R=r.next(g);K();for(var a=O.length-1;0<=a;--a){var b=O[a];b&&b(T,null,0)}k.flush();I&&I.update()}}function q(){!R&&0<O.length&&(R=r.next(g))}function t(){R&&(r.cancel(g),R=null)}function La(a){a.preventDefault();t();pa.forEach(function(a){a()})}
function za(a){k.getError();ma.restore();sa.restore();ka.restore();da.restore();ja.restore();la.restore();I&&I.restore();ea.procs.refresh();q();U.forEach(function(a){a()})}function Ga(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var g=a[b];x.isDynamic(g)?e[b]=x.unbox(g,b):c[b]=g});return{dynamic:e,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}var e=b(a.context||{}),g=b(a.uniforms||{}),k=b(a.attributes||{}),l=b(function(a){function b(a){if(a in c){var e=c[a];
delete c[a];Object.keys(e).forEach(function(b){c[a+"."+b]=e[b]})}}var c=h({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=ea.compile(l,k,g,e,a),m=e.draw,p=e.batch,n=e.scope,q=[];return h(function(a,b){var e;if("function"===typeof a)return n.call(this,
null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)n.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)n.call(this,a[e],b,e);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)},{stats:a})}function Z(a){O.push(a);q();return{cancel:function(){function b(){var a=l(O,b);O[a]=O[O.length-1];--O.length;0>=O.length&&t()}var c=
l(O,a);O[c]=b}}}function D(){var a=M.viewport,b=M.scissor_box;a[0]=a[1]=b[0]=b[1]=0;T.viewportWidth=T.framebufferWidth=T.drawingBufferWidth=a[2]=b[2]=k.drawingBufferWidth;T.viewportHeight=T.framebufferHeight=T.drawingBufferHeight=a[3]=b[3]=k.drawingBufferHeight}function K(){T.tick+=1;T.time=va();D();ea.procs.poll()}function Aa(){D();ea.procs.refresh();I&&I.update()}function va(){return(b()-ba)/1E3}c=e(c);if(!c)return null;var k=c.gl,V=k.getContextAttributes();k.isContextLost();var ma=E(k,c);if(!ma)return null;
var ga=a(),W=L(),P=ma.extensions,I=S(k,P),ba=b(),na=k.drawingBufferWidth,ya=k.drawingBufferHeight,T={tick:0,time:0,viewportWidth:na,viewportHeight:ya,framebufferWidth:na,framebufferHeight:ya,drawingBufferWidth:na,drawingBufferHeight:ya,pixelRatio:c.pixelRatio},ia=Q(k,P),ka=z(k,W,c),ra=y(k,P,ka,W),na=Y(k,P,ia,ka,ga),sa=w(k,ga,W,c),da=p(k,P,ia,function(){ea.procs.poll()},T,W,c),ja=F(k,P,ia,W,c),la=m(k,P,ia,da,ja,W),ea=G(k,ga,P,ia,ka,ra,da,la,{},na,sa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},
T,I,c),ga=n(k,la,ea.procs.poll,T,V,P),M=ea.next,ha=k.canvas,O=[],pa=[],U=[],X=[c.onDestroy],R=null;ha&&(ha.addEventListener("webglcontextlost",La,!1),ha.addEventListener("webglcontextrestored",za,!1));Aa();V=h(Ga,{clear:function(a){var b=0;ea.procs.poll();var c=a.color;c&&(k.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(k.clearDepth(+a.depth),b|=256);"stencil"in a&&(k.clearStencil(a.stencil|0),b|=1024);k.clear(b)},prop:x.define.bind(null,1),context:x.define.bind(null,2),
"this":x.define.bind(null,3),draw:Ga({}),buffer:function(a){return ka.create(a,34962,!1,!1)},elements:function(a){return ra.create(a,!1)},texture:da.create2D,cube:da.createCube,renderbuffer:ja.create,framebuffer:la.create,framebufferCube:la.createCube,attributes:V,frame:Z,on:function(a,b){var c;switch(a){case "frame":return Z(b);case "lost":c=pa;break;case "restore":c=U;break;case "destroy":c=X}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},
limits:ia,hasExtension:function(a){return 0<=ia.extensions.indexOf(a.toLowerCase())},read:ga,destroy:function(){O.length=0;t();ha&&(ha.removeEventListener("webglcontextlost",La),ha.removeEventListener("webglcontextrestored",za));sa.clear();la.clear();ja.clear();da.clear();ra.clear();ka.clear();I&&I.clear();X.forEach(function(a){a()})},_gl:k,_refresh:Aa,poll:function(){K();I&&I.update()},now:va,stats:W});c.onDone(null,V);return V}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,
"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":30,"./lib/webgl":33}]},{},[1]);
